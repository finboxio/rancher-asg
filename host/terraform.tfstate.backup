{
    "version": 1,
    "serial": 15,
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "aws_autoscaling_group.rancher-asg": {
                    "type": "aws_autoscaling_group",
                    "depends_on": [
                        "aws_elb.rancher-elb",
                        "aws_launch_configuration.rancher-lc"
                    ],
                    "primary": {
                        "id": "finboxio-default-host-asg",
                        "attributes": {
                            "availability_zones.#": "3",
                            "availability_zones.2050015877": "us-west-2c",
                            "availability_zones.221770259": "us-west-2b",
                            "availability_zones.2487133097": "us-west-2a",
                            "default_cooldown": "300",
                            "desired_capacity": "1",
                            "force_delete": "false",
                            "health_check_grace_period": "300",
                            "health_check_type": "EC2",
                            "id": "finboxio-default-host-asg",
                            "launch_configuration": "finboxio-default-host-nhqqpmzf55dkpbigt25uyfmmqa",
                            "load_balancers.#": "1",
                            "load_balancers.3112668450": "finboxio-default-host-elb",
                            "max_size": "1",
                            "metrics_granularity": "1Minute",
                            "min_size": "1",
                            "name": "finboxio-default-host-asg",
                            "placement_group": "",
                            "tag.#": "1",
                            "tag.2144766629.key": "Name",
                            "tag.2144766629.propagate_at_launch": "true",
                            "tag.2144766629.value": "finboxio-default-host-asg",
                            "termination_policies.#": "0",
                            "vpc_zone_identifier.#": "1",
                            "vpc_zone_identifier.0": "",
                            "wait_for_capacity_timeout": "10m"
                        }
                    }
                },
                "aws_elb.rancher-elb": {
                    "type": "aws_elb",
                    "depends_on": [
                        "aws_security_group.rancher-internal-sg",
                        "aws_security_group.rancher-sg"
                    ],
                    "primary": {
                        "id": "finboxio-default-host-elb",
                        "attributes": {
                            "access_logs.#": "0",
                            "availability_zones.#": "3",
                            "availability_zones.2050015877": "us-west-2c",
                            "availability_zones.221770259": "us-west-2b",
                            "availability_zones.2487133097": "us-west-2a",
                            "connection_draining": "true",
                            "connection_draining_timeout": "120",
                            "cross_zone_load_balancing": "true",
                            "dns_name": "finboxio-default-host-elb-1540090433.us-west-2.elb.amazonaws.com",
                            "health_check.#": "1",
                            "health_check.0.healthy_threshold": "10",
                            "health_check.0.interval": "30",
                            "health_check.0.target": "TCP:80",
                            "health_check.0.timeout": "5",
                            "health_check.0.unhealthy_threshold": "2",
                            "id": "finboxio-default-host-elb",
                            "idle_timeout": "120",
                            "instances.#": "0",
                            "internal": "false",
                            "listener.#": "2",
                            "listener.2974294026.instance_port": "80",
                            "listener.2974294026.instance_protocol": "tcp",
                            "listener.2974294026.lb_port": "80",
                            "listener.2974294026.lb_protocol": "tcp",
                            "listener.2974294026.ssl_certificate_id": "",
                            "listener.3604971863.instance_port": "80",
                            "listener.3604971863.instance_protocol": "tcp",
                            "listener.3604971863.lb_port": "443",
                            "listener.3604971863.lb_protocol": "ssl",
                            "listener.3604971863.ssl_certificate_id": "arn:aws:acm:us-west-2:783703853999:certificate/4afe9a81-f0dc-4041-b4a0-9a301bc23550",
                            "name": "finboxio-default-host-elb",
                            "security_groups.#": "2",
                            "security_groups.1339386100": "sg-595b2e3f",
                            "security_groups.179971226": "sg-5d5b2e3b",
                            "source_security_group": "783703853999/finboxio-default-host-sg",
                            "source_security_group_id": "sg-595b2e3f",
                            "subnets.#": "3",
                            "subnets.1414128276": "subnet-4ba6e03c",
                            "subnets.18525942": "subnet-98d74fc1",
                            "subnets.3214683748": "subnet-229fbf47",
                            "tags.#": "1",
                            "tags.Name": "finboxio-default-host-elb",
                            "zone_id": "Z33MTJ483KN6FU"
                        }
                    }
                },
                "aws_iam_instance_profile.rancher-iam-profile": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.rancher-iam-role"
                    ],
                    "primary": {
                        "id": "finboxio-default-host-iam-profile",
                        "attributes": {
                            "arn": "arn:aws:iam::783703853999:instance-profile/finboxio-default-host-iam-profile",
                            "id": "finboxio-default-host-iam-profile",
                            "name": "finboxio-default-host-iam-profile",
                            "path": "/",
                            "roles.#": "1",
                            "roles.994018802": "finboxio-default-host-iam-role"
                        }
                    }
                },
                "aws_iam_policy.rancher-iam-policy": {
                    "type": "aws_iam_policy",
                    "depends_on": [
                        "template_file.rancher-policy-data"
                    ],
                    "primary": {
                        "id": "arn:aws:iam::783703853999:policy/finboxio-default-host-iam-policy",
                        "attributes": {
                            "arn": "arn:aws:iam::783703853999:policy/finboxio-default-host-iam-policy",
                            "id": "arn:aws:iam::783703853999:policy/finboxio-default-host-iam-policy",
                            "name": "finboxio-default-host-iam-policy",
                            "path": "/",
                            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"s3:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": [\n        \"arn:aws:s3:::finboxio-default-host-config\",\n        \"arn:aws:s3:::finboxio-default-host-config/*\"\n      ]\n    },\n    {\n      \"Action\": \"ec2:DescribeVolumes\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Action\": [ \"ec2:AttachVolume\", \"ec2:DetachVolume\" ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ec2:*:*:volume/*\",\n      \"Condition\": {\n          \"StringLike\": {\n              \"ec2:ResourceTag/Name\": \"finboxio-default-rancher*\"\n          }\n      }\n    },\n    {\n      \"Action\": [ \"ec2:AttachVolume\", \"ec2:DetachVolume\" ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ec2:*:*:instance/*\",\n      \"Condition\": {\n          \"StringEquals\": {\n              \"ec2:ResourceTag/Name\": \"finboxio-default-rancher*\"\n          }\n      }\n    },\n    {\n      \"Action\": [\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeSnapshots\",\n        \"ec2:CreateSnapshot\",\n        \"ec2:CreateTags\",\n        \"ec2:DeleteSnapshot\",\n        \"ec2:CreateVolume\",\n        \"ec2:DescribeSpotInstanceRequests\",\n        \"ec2:RequestSpotInstances\",\n        \"ec2:CancelSpotInstanceRequests\",\n        \"ec2:TerminateInstances\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n"
                        }
                    }
                },
                "aws_iam_policy_attachment.rancher-iam-attachment": {
                    "type": "aws_iam_policy_attachment",
                    "depends_on": [
                        "aws_iam_policy.rancher-iam-policy",
                        "aws_iam_role.rancher-iam-role"
                    ],
                    "primary": {
                        "id": "finboxio-default-host-iam-attachment",
                        "attributes": {
                            "groups.#": "0",
                            "id": "finboxio-default-host-iam-attachment",
                            "name": "finboxio-default-host-iam-attachment",
                            "policy_arn": "arn:aws:iam::783703853999:policy/finboxio-default-host-iam-policy",
                            "roles.#": "1",
                            "roles.994018802": "finboxio-default-host-iam-role",
                            "users.#": "0"
                        }
                    }
                },
                "aws_iam_role.rancher-iam-role": {
                    "type": "aws_iam_role",
                    "primary": {
                        "id": "finboxio-default-host-iam-role",
                        "attributes": {
                            "arn": "arn:aws:iam::783703853999:role/finboxio-default-host-iam-role",
                            "assume_role_policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n",
                            "id": "finboxio-default-host-iam-role",
                            "name": "finboxio-default-host-iam-role",
                            "path": "/",
                            "unique_id": "AROAIEFKTALA2VX7ZKSZ4"
                        }
                    }
                },
                "aws_launch_configuration.rancher-lc": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_iam_instance_profile.rancher-iam-profile",
                        "aws_security_group.rancher-internal-sg",
                        "aws_security_group.rancher-sg",
                        "template_file.rancher-userdata-template"
                    ],
                    "primary": {
                        "id": "finboxio-default-host-nhqqpmzf55dkpbigt25uyfmmqa",
                        "attributes": {
                            "associate_public_ip_address": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "true",
                            "enable_monitoring": "false",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "finboxio-default-host-iam-profile",
                            "id": "finboxio-default-host-nhqqpmzf55dkpbigt25uyfmmqa",
                            "image_id": "ami-f0f03190",
                            "instance_type": "m4.large",
                            "key_name": "tino-macbook-pro-keypair",
                            "name": "finboxio-default-host-nhqqpmzf55dkpbigt25uyfmmqa",
                            "name_prefix": "finboxio-default-host-",
                            "root_block_device.#": "0",
                            "security_groups.#": "2",
                            "security_groups.1339386100": "sg-595b2e3f",
                            "security_groups.179971226": "sg-5d5b2e3b",
                            "spot_price": "0.05",
                            "user_data": "f1cc08b07fcf41d47534036a067ce441f5f18c60"
                        }
                    }
                },
                "aws_s3_bucket.rancher-bucket": {
                    "type": "aws_s3_bucket",
                    "primary": {
                        "id": "finboxio-default-host-config",
                        "attributes": {
                            "acl": "private",
                            "arn": "arn:aws:s3:::finboxio-default-host-config",
                            "bucket": "finboxio-default-host-config",
                            "cors_rule.#": "0",
                            "force_destroy": "true",
                            "hosted_zone_id": "Z3BJ6K6RIION7M",
                            "id": "finboxio-default-host-config",
                            "policy": "",
                            "region": "us-west-2",
                            "tags.#": "0",
                            "website.#": "0"
                        }
                    }
                },
                "aws_s3_bucket_object.rancher-config": {
                    "type": "aws_s3_bucket_object",
                    "depends_on": [
                        "aws_s3_bucket.rancher-bucket",
                        "template_file.rancher-config-template"
                    ],
                    "primary": {
                        "id": "rancher.conf",
                        "attributes": {
                            "bucket": "finboxio-default-host-config",
                            "cache_control": "",
                            "content": "export RANCHER_DEPLOYMENT_ID=finboxio-default\nexport RANCHER_URL=https://rancher.finbox.io\nexport RANCHER_ACCESS_KEY_ID=2D7EA43C32A1B03145D7\nexport RANCHER_SECRET_ACCESS_KEY=QSdYWXLM1HAn8fBWxF63ZvtHHoBJfs23L1UvbL4u\nexport RANCHER_HOST_LABELS=spot_price=.1\n",
                            "content_disposition": "",
                            "content_encoding": "",
                            "content_language": "",
                            "content_type": "binary/octet-stream",
                            "etag": "02d1a54ad0353fa2e043b7f40e597be0",
                            "id": "rancher.conf",
                            "key": "rancher.conf",
                            "kms_key_id": "",
                            "version_id": ""
                        }
                    }
                },
                "aws_security_group.rancher-internal-sg": {
                    "type": "aws_security_group",
                    "primary": {
                        "id": "sg-5d5b2e3b",
                        "attributes": {
                            "description": "Allow traffic to ports used by rancher",
                            "egress.#": "0",
                            "id": "sg-5d5b2e3b",
                            "ingress.#": "0",
                            "name": "finboxio-default-host-internal-sg",
                            "owner_id": "783703853999",
                            "tags.#": "0",
                            "vpc_id": "vpc-d95c0ebc"
                        }
                    }
                },
                "aws_security_group.rancher-sg": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_security_group.rancher-internal-sg"
                    ],
                    "primary": {
                        "id": "sg-595b2e3f",
                        "attributes": {
                            "description": "Allow traffic to ports used by rancher hosts",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-595b2e3f",
                            "ingress.#": "6",
                            "ingress.2214680975.cidr_blocks.#": "1",
                            "ingress.2214680975.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2214680975.from_port": "80",
                            "ingress.2214680975.protocol": "TCP",
                            "ingress.2214680975.security_groups.#": "0",
                            "ingress.2214680975.self": "false",
                            "ingress.2214680975.to_port": "80",
                            "ingress.2541437006.cidr_blocks.#": "1",
                            "ingress.2541437006.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2541437006.from_port": "22",
                            "ingress.2541437006.protocol": "TCP",
                            "ingress.2541437006.security_groups.#": "0",
                            "ingress.2541437006.self": "false",
                            "ingress.2541437006.to_port": "22",
                            "ingress.2573558714.cidr_blocks.#": "0",
                            "ingress.2573558714.from_port": "0",
                            "ingress.2573558714.protocol": "-1",
                            "ingress.2573558714.security_groups.#": "1",
                            "ingress.2573558714.security_groups.179971226": "sg-5d5b2e3b",
                            "ingress.2573558714.self": "false",
                            "ingress.2573558714.to_port": "0",
                            "ingress.2617001939.cidr_blocks.#": "1",
                            "ingress.2617001939.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2617001939.from_port": "443",
                            "ingress.2617001939.protocol": "TCP",
                            "ingress.2617001939.security_groups.#": "0",
                            "ingress.2617001939.self": "false",
                            "ingress.2617001939.to_port": "443",
                            "ingress.2651317642.cidr_blocks.#": "1",
                            "ingress.2651317642.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2651317642.from_port": "500",
                            "ingress.2651317642.protocol": "UDP",
                            "ingress.2651317642.security_groups.#": "0",
                            "ingress.2651317642.self": "false",
                            "ingress.2651317642.to_port": "500",
                            "ingress.4269942136.cidr_blocks.#": "1",
                            "ingress.4269942136.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.4269942136.from_port": "4500",
                            "ingress.4269942136.protocol": "UDP",
                            "ingress.4269942136.security_groups.#": "0",
                            "ingress.4269942136.self": "false",
                            "ingress.4269942136.to_port": "4500",
                            "name": "finboxio-default-host-sg",
                            "owner_id": "783703853999",
                            "tags.#": "0",
                            "vpc_id": "vpc-d95c0ebc"
                        }
                    }
                },
                "template_file.rancher-config-template": {
                    "type": "template_file",
                    "primary": {
                        "id": "5c3d19d62e20d4c4f68fbc429c86e109ffc4bd951b928ba64547a5df54567025",
                        "attributes": {
                            "id": "5c3d19d62e20d4c4f68fbc429c86e109ffc4bd951b928ba64547a5df54567025",
                            "rendered": "export RANCHER_DEPLOYMENT_ID=finboxio-default\nexport RANCHER_URL=https://rancher.finbox.io\nexport RANCHER_ACCESS_KEY_ID=2D7EA43C32A1B03145D7\nexport RANCHER_SECRET_ACCESS_KEY=QSdYWXLM1HAn8fBWxF63ZvtHHoBJfs23L1UvbL4u\nexport RANCHER_HOST_LABELS=spot_price=.1\n",
                            "template": "export RANCHER_DEPLOYMENT_ID=${deployment_id}\nexport RANCHER_URL=${rancher_url}\nexport RANCHER_ACCESS_KEY_ID=${rancher_access_key_id}\nexport RANCHER_SECRET_ACCESS_KEY=${rancher_secret_access_key}\nexport RANCHER_HOST_LABELS=${rancher_host_labels}\n",
                            "vars.#": "6",
                            "vars.deployment_id": "finboxio-default",
                            "vars.rancher_access_key_id": "2D7EA43C32A1B03145D7",
                            "vars.rancher_host_labels": "spot_price=.1",
                            "vars.rancher_secret_access_key": "QSdYWXLM1HAn8fBWxF63ZvtHHoBJfs23L1UvbL4u",
                            "vars.rancher_url": "https://rancher.finbox.io",
                            "vars.region": "us-west-2"
                        }
                    }
                },
                "template_file.rancher-policy-data": {
                    "type": "template_file",
                    "primary": {
                        "id": "d09fabd761cd1b1955fbd2b86f5b631a67852b74b8d1efc07f3989bb9c0ac13a",
                        "attributes": {
                            "id": "d09fabd761cd1b1955fbd2b86f5b631a67852b74b8d1efc07f3989bb9c0ac13a",
                            "rendered": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"s3:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": [\n        \"arn:aws:s3:::finboxio-default-host-config\",\n        \"arn:aws:s3:::finboxio-default-host-config/*\"\n      ]\n    },\n    {\n      \"Action\": \"ec2:DescribeVolumes\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Action\": [ \"ec2:AttachVolume\", \"ec2:DetachVolume\" ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ec2:*:*:volume/*\",\n      \"Condition\": {\n          \"StringLike\": {\n              \"ec2:ResourceTag/Name\": \"finboxio-default-rancher*\"\n          }\n      }\n    },\n    {\n      \"Action\": [ \"ec2:AttachVolume\", \"ec2:DetachVolume\" ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ec2:*:*:instance/*\",\n      \"Condition\": {\n          \"StringEquals\": {\n              \"ec2:ResourceTag/Name\": \"finboxio-default-rancher*\"\n          }\n      }\n    },\n    {\n      \"Action\": [\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeSnapshots\",\n        \"ec2:CreateSnapshot\",\n        \"ec2:CreateTags\",\n        \"ec2:DeleteSnapshot\",\n        \"ec2:CreateVolume\",\n        \"ec2:DescribeSpotInstanceRequests\",\n        \"ec2:RequestSpotInstances\",\n        \"ec2:CancelSpotInstanceRequests\",\n        \"ec2:TerminateInstances\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n",
                            "template": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"s3:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": [\n        \"arn:aws:s3:::${deployment_id}-host-config\",\n        \"arn:aws:s3:::${deployment_id}-host-config/*\"\n      ]\n    },\n    {\n      \"Action\": \"ec2:DescribeVolumes\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Action\": [ \"ec2:AttachVolume\", \"ec2:DetachVolume\" ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ec2:*:*:volume/*\",\n      \"Condition\": {\n          \"StringLike\": {\n              \"ec2:ResourceTag/Name\": \"${deployment_id}-rancher*\"\n          }\n      }\n    },\n    {\n      \"Action\": [ \"ec2:AttachVolume\", \"ec2:DetachVolume\" ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:ec2:*:*:instance/*\",\n      \"Condition\": {\n          \"StringEquals\": {\n              \"ec2:ResourceTag/Name\": \"${deployment_id}-rancher*\"\n          }\n      }\n    },\n    {\n      \"Action\": [\n        \"autoscaling:DescribeAutoScalingGroups\",\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeSnapshots\",\n        \"ec2:CreateSnapshot\",\n        \"ec2:CreateTags\",\n        \"ec2:DeleteSnapshot\",\n        \"ec2:CreateVolume\",\n        \"ec2:DescribeSpotInstanceRequests\",\n        \"ec2:RequestSpotInstances\",\n        \"ec2:CancelSpotInstanceRequests\",\n        \"ec2:TerminateInstances\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n",
                            "vars.#": "2",
                            "vars.deployment_id": "finboxio-default",
                            "vars.name": "rancher"
                        }
                    }
                },
                "template_file.rancher-userdata-template": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_s3_bucket.rancher-bucket"
                    ],
                    "primary": {
                        "id": "ef20953afdbd610f3a9e63d1e090910bdbffe67de363b84db4116e459cabbc75",
                        "attributes": {
                            "id": "ef20953afdbd610f3a9e63d1e090910bdbffe67de363b84db4116e459cabbc75",
                            "rendered": "#cloud-config\nrancher:\n  services:\n    rancher-host:\n      image: bdentino/rancher-host-asg\n      restart: on-failure\n      net: host\n      environment:\n        - S3_BUCKET=finboxio-default-host-config\n        - AWS_DEFAULT_REGION=us-west-2\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - /usr/bin/docker:/usr/bin/docker\n        - /var/lib/rancher/etc:/var/lib/rancher/etc\n",
                            "template": "#cloud-config\nrancher:\n  services:\n    rancher-host:\n      image: bdentino/rancher-host-asg\n      restart: on-failure\n      net: host\n      environment:\n        - S3_BUCKET=${rancher_s3_bucket}\n        - AWS_DEFAULT_REGION=${region}\n      volumes:\n        - /var/run/docker.sock:/var/run/docker.sock\n        - /usr/bin/docker:/usr/bin/docker\n        - /var/lib/rancher/etc:/var/lib/rancher/etc\n",
                            "vars.#": "2",
                            "vars.rancher_s3_bucket": "finboxio-default-host-config",
                            "vars.region": "us-west-2"
                        }
                    }
                }
            }
        }
    ]
}
